<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidaRol Launcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scrollbar-width: none; /* Firefox */
            background-color: transparent !important;
            -webkit-user-select: none;
            user-select: none;
        }
        body::-webkit-scrollbar { display: none; }
        img { -webkit-user-drag: none; }

        .launcher-container {
            background: linear-gradient(145deg, rgba(10, 0, 60, 0.7), rgba(0, 0, 63, 0.85)), 
                        url('https://mir-s3-cdn-cf.behance.net/project_modules/fs/869e3199533141.6878e0306ac7a.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .draggable { -webkit-app-region: drag; }

        #progressBar { background: linear-gradient(to right, #6a11cb, #2575fc); }

        #launcher-content-wrapper { transition: filter 0.3s ease-in-out; }

        #news-container {
            scrollbar-width: none;
            -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
        }
        #news-container::-webkit-scrollbar { display: none; }

        .glass-panel {
            background-color: rgba(24, 24, 27, 0.5);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        #launchButton {
            box-shadow: 0 0 15px rgba(147, 51, 234, 0.4), 0 0 30px rgba(147, 51, 234, 0.2);
        }
        #launchButton:hover:not(:disabled) {
            box-shadow: 0 0 25px rgba(147, 51, 234, 0.6), 0 0 45px rgba(147, 51, 234, 0.3);
        }

        .modal-hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }
        .modal-visible {
            opacity: 1;
            pointer-events: auto;
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden flex flex-col relative launcher-container">
        
        <div id="launcher-content-wrapper">
            <header class="bg-black/30 border-b border-white/10 px-6 py-3 flex items-center justify-between draggable">
                <div class="flex items-center gap-3">
                    <h1 class="text-xl font-extrabold text-white tracking-wider draggable">VidaRol</h1>
                </div>
                <div class="flex items-center gap-4">
                    <a id="discord-button" class="w-5 h-5 text-gray-400 hover:text-purple-400 cursor-pointer transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor"><path d="M524.5 133.8C524.3 133.5 524.1 133.2 523.7 133.1C485.6 115.6 445.3 103.1 404 96C403.6 95.9 403.2 96 402.9 96.1C402.6 96.2 402.3 96.5 402.1 96.9C396.6 106.8 391.6 117.1 387.2 127.5C342.6 120.7 297.3 120.7 252.8 127.5C248.3 117 243.3 106.8 237.7 96.9C237.5 96.6 237.2 96.3 236.9 96.1C236.6 95.9 236.2 95.9 235.8 95.9C194.5 103 154.2 115.5 116.1 133C115.8 133.1 115.5 133.4 115.3 133.7C39.1 247.5 18.2 358.6 28.4 468.2C28.4 468.5 28.5 468.7 28.6 469C28.7 469.3 28.9 469.4 29.1 469.6C73.5 502.5 123.1 527.6 175.9 543.8C176.3 543.9 176.7 543.9 177 543.8C177.3 543.7 177.7 543.4 177.9 543.1C189.2 527.7 199.3 511.3 207.9 494.3C208 494.1 208.1 493.8 208.1 493.5C208.1 493.2 208.1 493 208 492.7C207.9 492.4 207.8 492.2 207.6 492.1C207.4 492 207.2 491.8 206.9 491.7C191.1 485.6 175.7 478.3 161 469.8C160.7 469.6 160.5 469.4 160.3 469.2C160.1 469 160 468.6 160 468.3C160 468 160 467.7 160.2 467.4C160.4 467.1 160.5 466.9 160.8 466.7C163.9 464.4 167 462 169.9 459.6C170.2 459.4 170.5 459.2 170.8 459.2C171.1 459.2 171.5 459.2 171.8 459.3C268 503.2 372.2 503.2 467.3 459.3C467.6 459.2 468 459.1 468.3 459.1C468.6 459.1 469 459.3 469.2 459.5C472.1 461.9 475.2 464.4 478.3 466.7C478.5 466.9 478.7 467.1 478.9 467.4C479.1 467.7 479.1 468 479.1 468.3C479.1 468.6 479 468.9 478.8 469.2C478.6 469.5 478.4 469.7 478.2 469.8C463.5 478.4 448.2 485.7 432.3 491.6C432.1 491.7 431.8 491.8 431.6 492C431.4 492.2 431.3 492.4 431.2 492.7C431.1 493 431.1 493.2 431.1 493.5C431.1 493.8 431.2 494 431.3 494.3C440.1 511.3 450.1 527.6 461.3 543.1C461.5 543.4 461.9 543.7 462.2 543.8C462.5 543.9 463 543.9 463.3 543.8C516.2 527.6 565.9 502.5 610.4 469.6C610.6 469.4 610.8 469.2 610.9 469C611 468.8 611.1 468.5 611.1 468.2C623.4 341.4 590.6 231.3 524.2 133.7zM222.5 401.5C193.5 401.5 169.7 374.9 169.7 342.3C169.7 309.7 193.1 283.1 222.5 283.1C252.2 283.1 275.8 309.9 275.3 342.3C275.3 375 251.9 401.5 222.5 401.5zM417.9 401.5C388.9 401.5 365.1 374.9 365.1 342.3C365.1 309.7 388.5 283.1 417.9 283.1C447.6 283.1 471.2 309.9 470.7 342.3C470.7 375 447.5 401.5 417.9 401.5z"/></svg>
                    </a>
                    <svg id="minimize-button" class="w-5 h-5 text-gray-400 hover:text-purple-400 cursor-pointer transition-transform hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg>
                    <svg id="close-button" class="w-5 h-5 text-gray-400 hover:text-purple-400 cursor-pointer transition-transform hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </div>
            </header>

            <div class="px-6 py-4 bg-black/20 border-b border-white/10 flex items-center justify-center">
                <div class="relative w-52">
                    <input id="playerNameInput" type="text" placeholder="Nombre_Apellido" class="bg-zinc-800/80 border border-zinc-700 rounded-md py-1.5 px-4 w-full text-white placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-200">
                    <svg class="w-4 h-4 text-zinc-400 absolute right-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                </div>
            </div>
            
            <main class="flex-grow p-6">
                <div class="flex-grow mb-6 glass-panel rounded-lg p-5">
                    <div class="flex justify-between items-center mb-3 border-b border-white/20 pb-2">
                        <h2 class="text-xl font-bold text-white">Últimas Novedades</h2>
                    </div>
                    <div id="news-container" class="h-32 overflow-y-auto space-y-3 text-gray-300 text-sm pr-2">
                        <p>Cargando noticias...</p>
                    </div>
                </div>

                <div class="glass-panel rounded-lg p-4 flex items-center justify-between gap-6">
                    <div class="flex-grow">
                        <div id="player-count-container" class="text-center">
                            <p class="text-sm text-gray-400">Jugadores Conectados</p>
                            <p id="player-count-text" class="text-2xl font-bold text-white">...</p>
                        </div>
                        <div id="progress-container" class="hidden">
                            <div class="flex items-baseline justify-between mb-1">
                                <p id="statusText" class="text-sm font-medium text-gray-300">Instalando anticheat...</p>
                                <p id="progressDetails" class="text-xs text-gray-400">0.0 MB / 10.0 MB | 0%</p>
                            </div>
                            <div class="w-full bg-zinc-800 rounded-full h-2.5 border border-zinc-700 overflow-hidden">
                                <div id="progressBar" class="h-full rounded-full" style="width: 0%; transition: width 0.1s ease-out;"></div>
                            </div>
                        </div>
                    </div>
                    <button id="launchButton" class="bg-purple-600 text-white font-bold text-xl px-10 py-4 rounded-lg transition-all duration-300 ease-in-out hover:bg-purple-700 active:scale-95 disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center">
                        Jugar
                    </button>
                </div>
            </main>
        </div>

        <div id="notificationModal" class="absolute inset-0 bg-black/60 flex items-center justify-center z-50 p-4 modal-hidden">
            <div class="glass-panel rounded-lg shadow-2xl p-6 w-full max-w-sm text-center">
                <h3 class="text-xl font-bold text-white mb-3">Atención</h3>
                <p class="text-gray-300 mb-6">Debes colocar un nombre y apellido válidos (ej: Nombre_Apellido).</p>
                <button id="closeNotification" class="bg-purple-600 text-white font-bold px-8 py-2 rounded-lg transition-all duration-300 ease-in-out hover:bg-purple-700 active:scale-95">Entendido</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const config = {
                SERVER_IP: "45.126.208.53",
                SERVER_PORT: "7777",
                NEWS_API_URL: 'https://api-updatelaunch.vida-roleplay.es/api/news',
                PLAYER_COUNT_API_URL: 'https://corsproxy.io/?https://sam.markski.ar/api/GetServerByIP?ip_addr=45.126.208.53:7777',
                ANTICHEAT_TOTAL_SIZE_MB: 10.0,
                DISCORD_INVITE_URL: 'https://discord.com/invite/vida-rol-929898747155054683'
            };

            const elements = {
                discordButton: document.getElementById('discord-button'),
                closeButton: document.getElementById('close-button'),
                minimizeButton: document.getElementById('minimize-button'),
                launchButton: document.getElementById('launchButton'),
                playerNameInput: document.getElementById('playerNameInput'),
                playerCountContainer: document.getElementById('player-count-container'),
                playerCountText: document.getElementById('player-count-text'),
                progressContainer: document.getElementById('progress-container'),
                statusText: document.getElementById('statusText'),
                progressDetails: document.getElementById('progressDetails'),
                progressBar: document.getElementById('progressBar'),
                newsContainer: document.getElementById('news-container'),
                notificationModal: document.getElementById('notificationModal'),
                closeNotification: document.getElementById('closeNotification'),
                launcherContentWrapper: document.getElementById('launcher-content-wrapper'),
            };

            const getSafeColorClass = (color) => {
                const allowedColors = [
                    "green-400", "green-500",
                    "blue-400", "blue-500",
                    "red-400", "red-500",
                    "yellow-400", "yellow-500",
                    "purple-400", "purple-500",
                    "pink-400", "pink-500"
                ];

                const safeColorValue = color?.toLowerCase();

                if (allowedColors.includes(safeColorValue)) {
                    return `text-${safeColorValue}`;
                }
                
                return "text-gray-300";
            };

            const updateNews = async () => {
                try {
                    const response = await fetch(config.NEWS_API_URL);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const newsItems = await response.json();
                    elements.newsContainer.innerHTML = '';

                    if (!newsItems || newsItems.length === 0) {
                        elements.newsContainer.innerHTML = '<p>No hay noticias disponibles.</p>';
                        return;
                    }

                    const fragment = document.createDocumentFragment();
                    newsItems.forEach(item => {
                        const p = document.createElement('p');
                        p.className = 'transition-colors duration-200 hover:text-purple-300';
                        const tagSpan = document.createElement('span');
                        tagSpan.className = `font-semibold ${getSafeColorClass(item.color)}`;
                        tagSpan.textContent = `[${item.type}]`;
                        p.appendChild(tagSpan);
                        p.appendChild(document.createTextNode(` ${item.text}`));
                        fragment.appendChild(p);
                    });
                    elements.newsContainer.appendChild(fragment);

                } catch (error) {
                    console.error("Error fetching news:", error);
                    elements.newsContainer.innerHTML = '<p class="text-red-400">No se pudieron cargar las noticias.</p>';
                }
            };

            const updatePlayerCount = async () => {
                try {
                    const response = await fetch(config.PLAYER_COUNT_API_URL);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    elements.playerCountText.textContent = data?.playersOnline ?? 'Offline';
                } catch (error) {
                    console.error("Error fetching player count:", error);
                    elements.playerCountText.textContent = 'Error';
                }
            };
            
            const showNotificationModal = () => {
                elements.launcherContentWrapper.classList.add('blur-sm');
                elements.notificationModal.classList.remove('modal-hidden');
                elements.notificationModal.classList.add('modal-visible');
            };

            const closeNotificationModal = () => {
                elements.launcherContentWrapper.classList.remove('blur-sm');
                elements.notificationModal.classList.add('modal-hidden');
                elements.notificationModal.classList.remove('modal-visible');
            };
            
            const updateProgressBarUI = (progress) => {
                const downloadedMB = (config.ANTICHEAT_TOTAL_SIZE_MB * progress / 100).toFixed(1);
                elements.progressBar.style.width = `${progress}%`;
                elements.progressDetails.textContent = `${downloadedMB} MB / ${config.ANTICHEAT_TOTAL_SIZE_MB.toFixed(1)} MB | ${Math.round(progress)}%`;
            };

            const handleLaunch = () => {
                const playerName = elements.playerNameInput.value.trim();
                const nameRegex = /^[A-Za-z]+_[A-Za-z]+$/;
                if (!playerName || !nameRegex.test(playerName)) {
                    showNotificationModal();
                    return;
                }

                elements.playerCountContainer.classList.add('hidden');
                elements.progressContainer.classList.remove('hidden');
                elements.launchButton.disabled = true;
                elements.launchButton.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Cargando...`;
                elements.statusText.textContent = 'Verificando archivos...';

                let progress = 0;
                const downloadInterval = setInterval(() => {
                    progress += Math.random() * 5.5 + 2;
                    
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(downloadInterval);
                        elements.statusText.textContent = '¡Iniciando juego!';
                        
                        const message = `launch-game:${config.SERVER_IP}:${config.SERVER_PORT}:${playerName}`;
                        window.chrome?.webview?.postMessage(message);
                    }
                    
                    updateProgressBarUI(progress);
                }, 80);
            };
            
            const initializeApp = () => {
                elements.launchButton.addEventListener('click', handleLaunch);
                elements.discordButton.addEventListener('click', () => {
                    window.open(config.DISCORD_INVITE_URL, '_blank', 'noopener,noreferrer');
                });
                elements.closeButton.addEventListener('click', () => window.chrome?.webview?.postMessage('close-app'));
                elements.minimizeButton.addEventListener('click', () => window.chrome?.webview?.postMessage('minimize-app'));
                elements.closeNotification.addEventListener('click', closeNotificationModal);
                
                elements.notificationModal.addEventListener('click', (e) => {
                    if (e.target === elements.notificationModal) {
                        closeNotificationModal();
                    }
                });
                
                updatePlayerCount();
                updateNews();
                setInterval(updatePlayerCount, 60000); 
            };

            initializeApp();
        });
    </script>
</body>
</html>
